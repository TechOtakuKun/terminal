!function(r){function t(r){this.string=r,this.clearString=r,this.varHash={}}t.prototype={init:function(r){if("string"!=typeof r)throw new Error("参数错误：init()的参数必须为string类型");var r=UT.trim(r);return r?(r=this.preProcess(r),this.command(r)):""},preProcess:function(r){var t="";return r.replace(/\'[^']*\'|\"[^"]*\"/g,function(r){do{t=UT.getRandString()}while(t in this.varHash);return this.varHash[t]=r,t}.bind(this))},command:function(r){var r=UT.trim(r),t=r.length;return";"==r[t-1]?(this.sentence(r.substring(0,t-1)),null):this.sentence(r)},sentence:function(r){var r=UT.trim(r),t=[];if(t=r.match(/^if\s*\((.*)\)\s*(.*)else\s*(.*)\s*end\s*/)){var i=t[1],e=t[2],n=t[3];return this.expr(i)?this.sentence(e):this.sentence(n)}for(var s=/([^\w]*)(sin|cos|max|min)*\s*\(([^()]*)\)/;s.test(r);)r=r.replace(s,function(r,t,i,e){if("sin"==i)return t+Math.sin(this.arithExpr(e));if("cos"==i)return t+Math.cos(this.arithExpr(e));var n=e.split(",").map(function(r){return this.arithExpr(r)}.bind(this));switch(i){case"max":return t+UT.max(n);case"min":return t+UT.min(n);default:return t+this.arithExpr(e)}}.bind(this)),console.log(r);for(var a=/([^\?\:]*)\?([^\?\:]*)\:(.*)/;a.test(r);)r=r.replace(a,function(r,t,i,e){return this.boolExpr(t)?this.sentence(i):this.sentence(e)}.bind(this)),console.log(r);if(t=r.match(/^(\s*\w+\s*)\=(.)*/)){var h=UT.trim(t[1]),o=UT.trim(t[2]);if(!UT.isVariable(h))throw new Error("Uncaught SyntaxError: Invalid or unexpected token");if(UT.isDel(o))return this.varHash[h]=null,"Prompt: variable '"+h+"' is deleted";var c=this.expr(o);return this.varHash[h]=c,h+" = "+c}return"ans = "+this.expr(r)},expr:function(r){return this.arithExpr(r)},arithExpr:function(r){r=UT.trim(r);if(r=r.replace(/([\+\-\*\/\^])\s*([\d\.]+)(e[\+\-][\d\.]*)/gi,function(r,t,i,e){return t+parseFloat(i+e)}),UT.isNumber(r))return parseFloat(r);if(UT.isBool(r))return"true"==r;if(UT.isVariable(r)){if(this.varHash.hasOwnProperty(r)&&null!=this.varHash[r])return this.varHash[r];throw new Error("Uncaught ReferenceError: "+r+" is not defined")}var t="",i="",e="",n=[];if(n=r.match(/(.*)(==|!=|<=|>=|>|<|&&|\|\||!)(.+)/))return this.boolExpr(r);if(n=r.match(/(.*\w+)\s*([\+\-])(.+)/))return t=n[1],i=n[2],e=n[3],UT.calculate(this.arithExpr(t),this.arithExpr(e),i);if(n=r.match(/(.*\w+)\s*([\*\/\%])(.+)/))return t=n[1],i=n[2],e=n[3],UT.calculate(this.arithExpr(t),this.arithExpr(e),i);if(n=r.match(/([^\/^]*\w+)\s*([\^])(.+)/))return t=n[1],e=n[3],Math.pow(this.arithExpr(t),this.arithExpr(e));throw new Error("Uncaught SyntaxError: Invalid or unexpected token")},boolExpr:function(r){r=UT.trim(r);if(UT.isBool(r))return"true"==r;var t=r.match(/(.*)(==|!=|<=|>=|>|<|&&|\|\||!)(.+)/);if(!t)throw new Error("Uncaught SyntaxError: Invalid or unexpected token");var i=t[1],e=t[2],n=t[3];switch(e){case"==":return this.arithExpr(i)==this.arithExpr(n);case"!=":return this.arithExpr(i)!=this.arithExpr(n);case"<=":return this.arithExpr(i)<=this.arithExpr(n);case">=":return this.arithExpr(i)>=this.arithExpr(n);case"<":return this.arithExpr(i)<this.arithExpr(n);case">":return this.arithExpr(i)>this.arithExpr(n);case"&&":return this.arithExpr(i)&&this.arithExpr(n);case"||":return this.arithExpr(i)||this.arithExpr(n);case"!":if(i)throw new Error("Uncaught SyntaxError: Invalid or unexpected token");return!this.arithExpr(n);default:throw new Error("Uncaught SyntaxError: Invalid or unexpected token")}}},r.BNF=t}(window);